{% extends "base.html" %}
{% block content %}
<section class="panel" style="display: grid; gap: 1rem;">
  <div style="display: flex; justify-content: space-between; align-items: center; gap: 1rem; flex-wrap: wrap;">
    <div>
      <p class="pill">Editing session</p>
      <h2 style="margin: 0.3rem 0 0.25rem;">{{ session.filename }}</h2>
      <p class="muted" style="margin: 0;">{{ line_count }} lines â€¢ Source: {{ session.source_format | upper }}</p>
    </div>
    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
      <a class="cta secondary" href="/download/{{ session.session_id }}?format=json">Download JSON</a>
      <a class="cta secondary" href="/download/{{ session.session_id }}?format=sav">Download .sav</a>
    </div>
  </div>

  <form action="/edit/{{ session.session_id }}" method="post" style="display: grid; gap: 0.75rem;">
    <div style="position: relative; border: 1px solid var(--border); border-radius: 12px; overflow: hidden; background: #0a1425;">
      <div style="
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 60px;
        border-right: 1px solid var(--border);
        background: rgba(255,255,255,0.02);
        padding: 0.85rem 0.4rem;
        text-align: right;
        font-family: 'JetBrains Mono', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
        color: var(--muted);
        line-height: 1.5;
        white-space: pre;
        pointer-events: none;
        user-select: none;
      " id="line-numbers">
        {% for number in line_numbers %}
{{ number }}
        {% endfor %}
      </div>
      <textarea name="json_body" spellcheck="false" style="
        width: 100%;
        height: 65vh;
        border: none;
        outline: none;
        resize: vertical;
        padding: 0.85rem 1rem 0.85rem 4.5rem;
        font-size: 0.95rem;
        font-family: 'JetBrains Mono', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
        background: transparent;
        color: var(--text);
        line-height: 1.5;
        tab-size: 2;
      ">{{ session.json_text }}</textarea>
    </div>
    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; justify-content: flex-end;">
      <button class="cta secondary" type="reset">Reset</button>
      <button class="cta" type="submit">Save changes</button>
    </div>
  </form>
</section>
{% endblock %}
